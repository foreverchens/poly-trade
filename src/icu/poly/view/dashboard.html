<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8" />
        <title>Polymarket 仓位看板（最小可用）</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <link rel="stylesheet" href="/dashboard/dashboard.css" />
    </head>

    <body>
        <div class="wrap">
            <h1 class="title"
                >Polymarket 仓位看板 <span class="chip">最小可用</span>
                <a href="/" class="home-link">返回市场</a></h1
            >

            <div class="bar">
                <input id="addr" spellcheck="false" placeholder="输入地址（0x...）" value="" />
                <button id="refresh">刷新</button>
                <span id="status" class="muted"></span>
            </div>

            <div class="summary" id="summary">
                <div>持有价值：<b id="sumValue">—</b></div>
                <div>当前盈亏：<b id="sumPnl">—</b>（<span id="sumPnlPct">—</span>）</div>
                <div class="muted">仅展示 size ≥ 1 且 currentValue > 1 的持仓</div>
            </div>

            <div class="pnl-dashboard" id="pnlDashboard">
                <div class="pnl-item">
                    <div class="label">当前浮动盈亏</div>
                    <div class="value" id="currentPnl">—</div>
                    <div class="percent" id="currentPnlPct">—</div>
                </div>
                <div class="pnl-item">
                    <div class="label">最近24h盈亏</div>
                    <div class="value" id="last24hPnl">—</div>
                    <div class="percent" id="last24hPnlPct">—</div>
                </div>
                <div class="pnl-item">
                    <div class="label">至今盈亏</div>
                    <div class="value" id="totalPnl">—</div>
                    <div class="percent" id="totalPnlPct">—</div>
                </div>
            </div>

            <div class="section-head">
                <h2 class="subtitle">持仓</h2>
                <div class="section-actions">
                    <label>
                        <input type="checkbox" id="hideSmallPositions" />
                        <span>显示小额仓位</span>
                    </label>
                    <button id="positionRefresh">刷新持仓</button>
                </div>
            </div>

            <table id="tbl">
                <thead>
                    <tr>
                        <th>资产</th>
                        <th>数量</th>
                        <th>成交价</th>
                        <th>最优买价</th>
                        <th>最优卖价</th>
                        <th>持有价值</th>
                        <th>当前盈亏</th>
                        <th>平仓</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>

            <div class="section-head">
                <h2 class="subtitle">当前挂单</h2>
                <div class="section-actions">
                    <span id="openOrderStatus" class="muted">等待加载…</span>
                    <button id="openOrderRefresh">刷新挂单</button>
                </div>
            </div>

            <table id="openOrderTable">
                <thead>
                    <tr>
                        <th>订单ID</th>
                        <th>市场</th>
                        <th>方向</th>
                        <th>价格</th>
                        <th>初始数量</th>
                        <th>成交数量</th>
                        <th>状态</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="openOrderBody">
                    <tr>
                        <td colspan="8" class="muted" data-th="提示">等待加载…</td>
                    </tr>
                </tbody>
            </table>

            <div class="section-head">
                <h2 class="subtitle">最近成交（3天内，最多 50 条）</h2>
                <div class="section-actions">
                    <span id="tradeStatus" class="muted">等待加载…</span>
                    <button id="tradeRefresh">刷新成交</button>
                </div>
            </div>

            <table id="tradeTable">
                <thead>
                    <tr>
                        <th>市场</th>
                        <th>订单ID</th>
                        <th>市场方向</th>
                        <th>订单方向</th>
                        <th>价格</th>
                        <th>数量</th>
                        <th>成交额</th>
                        <th>成交时间</th>
                        <th>Tx</th>
                    </tr>
                </thead>
                <tbody id="tradeBody">
                    <tr>
                        <td colspan="9" class="muted" data-th="提示">等待加载…</td>
                    </tr>
                </tbody>
            </table>

            <div class="footer">
                <div class="tip"
                    >说明：持有价值按 <code>size × curPrice</code> 现场计算；盈亏使用接口返回
                    <code>cashPnl / percentPnl</code>，若缺失则现场推导。</div
                >
            </div>
        </div>

        <div id="toastContainer" class="toast-container"></div>

        <script src="/dashboard/dashboard.js"></script>
    </body>
</html>
