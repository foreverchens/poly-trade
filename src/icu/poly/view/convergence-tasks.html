<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8" />
        <title>扫尾盘任务配置</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <link rel="stylesheet" href="/convergence-tasks/convergence-tasks.css" />
    </head>

    <body>
        <div class="page">
            <header>
                <div>
                    <h1>扫尾盘任务配置</h1>
                    <p>Pin 到数据库的一切字段都在此，双击单元格即可编辑，改动自动保存。</p>
                    <div class="balance-summary">
                        <span class="balance-label">钱包总余额：</span>
                        <span id="total-balance" class="balance-value">-</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button id="btn-refresh" type="button" class="secondary">刷新列表</button>
                    <button id="btn-create" type="button">新增配置</button>
                </div>
            </header>
            <div class="tips"
                >提示：① 双击单元格开启编辑；② Enter / 失焦即保存；③ Esc 取消；④
                新增行请在操作列中点击保存。</div
            >
            <div id="message" class="message"></div>
            <section class="table-card">
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr id="table-header-row"></tr>
                        </thead>
                        <tbody id="task-table-body">
                            <tr>
                                <td class="empty">加载中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            <section class="accounts-card">
                <div class="accounts-header">
                    <h2>钱包地址列表</h2>
                    <button id="btn-refresh-accounts" type="button" class="secondary">刷新余额</button>
                </div>
                <div class="accounts-wrapper">
                    <table class="accounts-table">
                        <thead>
                            <tr>
                                <th>pkIdx</th>
                                <th>地址</th>
                                <th>POL 余额</th>
                                <th>USDC.e 余额</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="accounts-table-body">
                            <tr>
                                <td class="empty" colspan="5">加载中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            <section class="balance-chart-card">
                <div class="balance-chart-header">
                    <h2>余额曲线</h2>
                    <div class="balance-chart-controls">
                        <select id="balance-chart-days" class="chart-select">
                            <option value="3">最近3天</option>
                            <option value="7" selected>最近7天</option>
                            <option value="14">最近14天</option>
                            <option value="30">最近30天</option>
                        </select>
                        <button id="btn-refresh-chart" type="button" class="secondary">刷新图表</button>
                    </div>
                </div>
                <div id="balance-chart-container" class="balance-chart-container">
                    <div class="chart-loading">加载中...</div>
                </div>
            </section>
        </div>

        <!-- 划转模态对话框 -->
        <div id="transfer-modal" class="modal" style="display: none;">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="transfer-modal-title">划转</h3>
                    <button class="modal-close" type="button" aria-label="关闭">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="transfer-to">接收地址</label>
                        <input
                            type="text"
                            id="transfer-to"
                            class="form-input"
                            placeholder="0x..."
                            autocomplete="off"
                        />
                        <div class="form-hint">请输入有效的以太坊地址</div>
                    </div>
                    <div class="form-group">
                        <label for="transfer-amount">划转金额</label>
                        <div class="input-with-unit">
                            <input
                                type="number"
                                id="transfer-amount"
                                class="form-input"
                                placeholder="0.00"
                                step="any"
                                min="0"
                                autocomplete="off"
                            />
                            <span id="transfer-unit" class="input-unit">POL</span>
                        </div>
                        <div class="form-hint">
                            请输入要划转的金额
                            <button type="button" id="transfer-max-btn" class="max-amount-btn">最大额度</button>
                        </div>
                    </div>
                    <div class="transfer-info">
                        <div class="info-row">
                            <span class="info-label">发送地址:</span>
                            <span id="transfer-from-address" class="info-value">-</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="transfer-cancel">取消</button>
                    <button type="button" class="btn-primary" id="transfer-confirm">确认划转</button>
                </div>
            </div>
        </div>

        <script type="module" src="/convergence-tasks/convergence-tasks.js"></script>
    </body>
</html>
